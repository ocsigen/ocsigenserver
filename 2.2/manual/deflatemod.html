<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Deflatemod</title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js"></script><script src="/js/client.js"></script></head><body class="ocsigenserver 2.2 deflatemod"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href="/" class="ocsimore_phrasing_link"><img src="/img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Server
</p><ul class="mainmenu"><li class="mainmenu-home"><a href="/" class="ocsimore_phrasing_link">Home</a>
</li><li class="mainmenu-doc"><a href="/tuto/6.2/manual/intro" class="ocsimore_phrasing_link">Doc</a>
</li><li><a href="/eliom/6.3/manual/intro" class="ocsimore_phrasing_link">Eliom</a>
</li><li><a href="/js_of_ocaml/3.1.0/manual/overview" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li><a href="/lwt/3.3.0/manual/manual" class="ocsimore_phrasing_link">Lwt</a>
</li><li><a href="/tyxml/4.1.0/manual/intro" class="ocsimore_phrasing_link">Tyxml</a>
</li><li><a href="/ocsigen-start/1.1.0/manual/intro" class="ocsimore_phrasing_link">Start</a>
</li></ul><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href="/" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href="/tuto/6.2/manual/intro" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href="/eliom/6.3/manual/intro" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href="/js_of_ocaml/3.1.0/manual/overview" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-current drawermainmenu-project"><a href="/ocsigenserver/2.9/manual/quickstart" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href="/lwt/3.3.0/manual/manual" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href="/tyxml/4.1.0/manual/intro" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href="/ocsigen-toolkit/1.1.0/manual/intro" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href="/ocsigen-start/1.1.0/manual/intro" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-page"><a href="/projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href="/papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href="/credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href="/blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"><h1>Ocsigen server</h1><h2>Usage</h2><h3><a href="/ocsigenserver/2.2/manual/quickstart" class="ocsimore_phrasing_link">Quick start</a></h3><h3><a href="/ocsigenserver/2.2/manual/launching" class="ocsimore_phrasing_link">Launching the server</a></h3><h3><a href="/ocsigenserver/2.2/manual/config" class="ocsimore_phrasing_link">Configuration file</a></h3><h3><a href="/ocsigenserver/2.2/manual/misc" class="ocsimore_phrasing_link">Misc</a></h3><h2>Extensions</h2><h3><a href="/ocsigenserver/2.2/manual/staticmod" class="ocsimore_phrasing_link">Staticmod</a></h3><h3><a href="/ocsigenserver/2.2/manual/eliom" class="ocsimore_phrasing_link">Eliom</a></h3><h3><a href="/ocsigenserver/2.2/manual/extendconfiguration" class="ocsimore_phrasing_link">Extendconfiguration</a></h3><h3><a href="/ocsigenserver/2.2/manual/accesscontrol" class="ocsimore_phrasing_link">Accesscontrol</a></h3><h3><a href="/ocsigenserver/2.2/manual/authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h3><a href="/ocsigenserver/2.2/manual/cgimod" class="ocsimore_phrasing_link">CGImod</a></h3><h3><a href="/ocsigenserver/2.2/manual/deflatemod" class="ocsimore_phrasing_link">Deflatemod</a></h3><h3><a href="/ocsigenserver/2.2/manual/redirectmod" class="ocsimore_phrasing_link">Redirectmod</a></h3><h3><a href="/ocsigenserver/2.2/manual/revproxy" class="ocsimore_phrasing_link">Revproxy</a></h3><h3><a href="/ocsigenserver/2.2/manual/rewritemod" class="ocsimore_phrasing_link">Rewritemod</a></h3><h3><a href="/ocsigenserver/2.2/manual/outputfilter" class="ocsimore_phrasing_link">Outputfilter</a></h3><h3><a href="/ocsigenserver/2.2/manual/userconf" class="ocsimore_phrasing_link">Userconf</a></h3><h3><a href="/ocsigenserver/2.2/manual/comet" class="ocsimore_phrasing_link">Comet</a></h3><h3><a href="/ocsigenserver/2.2/manual/cors" class="ocsimore_phrasing_link">CORS</a></h3><h2>Developer documentation</h2><h3>Developing with the Ocsigen framework</h3><h4><a href="/ocsigenserver/2.2/manual/lwtoc" class="ocsimore_phrasing_link">Cooperative threads</a></h4><h4><a href="/ocsigenserver/2.2/manual/staticlink" class="ocsimore_phrasing_link">Static linking of the Ocsigen server</a></h4><h3><a href="/ocsigenserver/2.2/manual/extend" class="ocsimore_phrasing_link">Writing an extension</a></h3><h3><a href="/ocsigenserver/2.2/manual/libraries" class="ocsimore_phrasing_link">Libraries</a></h3><h3><a href="/ocsigenserver/2.2/manual/wrapping" class="ocsimore_phrasing_link">specific wrapping</a></h3><h1>Ocsigen server - API reference</h1><h2>Persistent data, writing in the logs, configuration file extension, polymorphic tables</h2><h3><a href="/ocsigenserver/2.2/api/Ocsigen_lib" class="ocsimore_phrasing_link">Ocsigen_lib</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_messages" class="ocsimore_phrasing_link">Ocsigen_messages</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_parseconfig" class="ocsimore_phrasing_link">Ocsigen_parseconfig</a></h3><h3><a href="/ocsigenserver/2.2/api/Polytables" class="ocsimore_phrasing_link">Polytables</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_cache" class="ocsimore_phrasing_link">Ocsigen_cache</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsipersist" class="ocsimore_phrasing_link">Ocsipersist</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_config" class="ocsimore_phrasing_link">Ocsigen_config</a></h3><h2>Extending Ocsigen</h2><h3><a href="/ocsigenserver/2.2/api/Ocsigen_extensions" class="ocsimore_phrasing_link">Ocsigen_extensions</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_local_files" class="ocsimore_phrasing_link">Ocsigen_local_files</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_headers" class="ocsimore_phrasing_link">Ocsigen_headers</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_senders" class="ocsimore_phrasing_link">Ocsigen_senders</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_http_frame" class="ocsimore_phrasing_link">Ocsigen_http_frame</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_http_client" class="ocsimore_phrasing_link">Ocsigen_http_client</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_http_com" class="ocsimore_phrasing_link">Ocsigen_http_com</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_stream" class="ocsimore_phrasing_link">Ocsigen_stream</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_comet" class="ocsimore_phrasing_link">Ocsigen_comet</a></h3><h3><a href="/ocsigenserver/2.2/api/Authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h2>Indexes</h2><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_types">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_values">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_methods">Index of class methods</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_classes">Index of classes</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_modules">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_module_types">Index of module types</a></span></h3></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value="/ocsigenserver/dev/manual/deflatemod">dev</option><option value="/ocsigenserver/2.9/manual/deflatemod">2.9</option><option value="/ocsigenserver/2.8/manual/deflatemod">2.8</option><option value="/ocsigenserver/2.7/manual/deflatemod">2.7</option><option value="/ocsigenserver/2.6/manual/deflatemod">2.6</option><option value="/ocsigenserver/2.5/manual/deflatemod">2.5</option><option value="/ocsigenserver/2.3/manual/deflatemod">2.3</option><option selected="selected">2.2</option><option value="/ocsigenserver/2.1/manual/deflatemod">2.1</option><option value="/ocsigenserver/1.3.4/manual/deflatemod">1.3.4</option><option value="/ocsigenserver/1.2.2/manual/deflatemod">1.2.2</option><option value="/ocsigenserver/1.1.0/manual/deflatemod">1.1.0</option></select><form id="search"><input name="q" id="q" placeholder="search ..."/><button>Search</button></form><nav class="how-doctree"><h1>Ocsigen server</h1><h2>Usage</h2><h3><a href="/ocsigenserver/2.2/manual/quickstart" class="ocsimore_phrasing_link">Quick start</a></h3><h3><a href="/ocsigenserver/2.2/manual/launching" class="ocsimore_phrasing_link">Launching the server</a></h3><h3><a href="/ocsigenserver/2.2/manual/config" class="ocsimore_phrasing_link">Configuration file</a></h3><h3><a href="/ocsigenserver/2.2/manual/misc" class="ocsimore_phrasing_link">Misc</a></h3><h2>Extensions</h2><h3><a href="/ocsigenserver/2.2/manual/staticmod" class="ocsimore_phrasing_link">Staticmod</a></h3><h3><a href="/ocsigenserver/2.2/manual/eliom" class="ocsimore_phrasing_link">Eliom</a></h3><h3><a href="/ocsigenserver/2.2/manual/extendconfiguration" class="ocsimore_phrasing_link">Extendconfiguration</a></h3><h3><a href="/ocsigenserver/2.2/manual/accesscontrol" class="ocsimore_phrasing_link">Accesscontrol</a></h3><h3><a href="/ocsigenserver/2.2/manual/authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h3><a href="/ocsigenserver/2.2/manual/cgimod" class="ocsimore_phrasing_link">CGImod</a></h3><h3><a href="/ocsigenserver/2.2/manual/deflatemod" class="ocsimore_phrasing_link">Deflatemod</a></h3><h3><a href="/ocsigenserver/2.2/manual/redirectmod" class="ocsimore_phrasing_link">Redirectmod</a></h3><h3><a href="/ocsigenserver/2.2/manual/revproxy" class="ocsimore_phrasing_link">Revproxy</a></h3><h3><a href="/ocsigenserver/2.2/manual/rewritemod" class="ocsimore_phrasing_link">Rewritemod</a></h3><h3><a href="/ocsigenserver/2.2/manual/outputfilter" class="ocsimore_phrasing_link">Outputfilter</a></h3><h3><a href="/ocsigenserver/2.2/manual/userconf" class="ocsimore_phrasing_link">Userconf</a></h3><h3><a href="/ocsigenserver/2.2/manual/comet" class="ocsimore_phrasing_link">Comet</a></h3><h3><a href="/ocsigenserver/2.2/manual/cors" class="ocsimore_phrasing_link">CORS</a></h3><h2>Developer documentation</h2><h3>Developing with the Ocsigen framework</h3><h4><a href="/ocsigenserver/2.2/manual/lwtoc" class="ocsimore_phrasing_link">Cooperative threads</a></h4><h4><a href="/ocsigenserver/2.2/manual/staticlink" class="ocsimore_phrasing_link">Static linking of the Ocsigen server</a></h4><h3><a href="/ocsigenserver/2.2/manual/extend" class="ocsimore_phrasing_link">Writing an extension</a></h3><h3><a href="/ocsigenserver/2.2/manual/libraries" class="ocsimore_phrasing_link">Libraries</a></h3><h3><a href="/ocsigenserver/2.2/manual/wrapping" class="ocsimore_phrasing_link">specific wrapping</a></h3><h1>Ocsigen server - API reference</h1><h2>Persistent data, writing in the logs, configuration file extension, polymorphic tables</h2><h3><a href="/ocsigenserver/2.2/api/Ocsigen_lib" class="ocsimore_phrasing_link">Ocsigen_lib</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_messages" class="ocsimore_phrasing_link">Ocsigen_messages</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_parseconfig" class="ocsimore_phrasing_link">Ocsigen_parseconfig</a></h3><h3><a href="/ocsigenserver/2.2/api/Polytables" class="ocsimore_phrasing_link">Polytables</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_cache" class="ocsimore_phrasing_link">Ocsigen_cache</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsipersist" class="ocsimore_phrasing_link">Ocsipersist</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_config" class="ocsimore_phrasing_link">Ocsigen_config</a></h3><h2>Extending Ocsigen</h2><h3><a href="/ocsigenserver/2.2/api/Ocsigen_extensions" class="ocsimore_phrasing_link">Ocsigen_extensions</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_local_files" class="ocsimore_phrasing_link">Ocsigen_local_files</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_headers" class="ocsimore_phrasing_link">Ocsigen_headers</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_senders" class="ocsimore_phrasing_link">Ocsigen_senders</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_http_frame" class="ocsimore_phrasing_link">Ocsigen_http_frame</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_http_client" class="ocsimore_phrasing_link">Ocsigen_http_client</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_http_com" class="ocsimore_phrasing_link">Ocsigen_http_com</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_stream" class="ocsimore_phrasing_link">Ocsigen_stream</a></h3><h3><a href="/ocsigenserver/2.2/api/Ocsigen_comet" class="ocsimore_phrasing_link">Ocsigen_comet</a></h3><h3><a href="/ocsigenserver/2.2/api/Authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h2>Indexes</h2><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_types">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_values">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_methods">Index of class methods</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_classes">Index of classes</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_modules">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.2/api/index_module_types">Index of module types</a></span></h3></nav></nav><article class="rightcol"><h1>Deflatemod</h1><p>Deflatemod is in beta version. Submit your bugs and feature wishes <a href="https://github.com/ocsigen/ocsigenserver" class="ocsimore_phrasing_link">here</a>.
</p><h2> Usage </h2><h3> What is deflatemod?</h3><p>Deflatemod is a module for Ocsigen that allows you to
deflate content, using HTTP/1.1 mechanism. It supports gzip as well as
deflate.
</p><h3> What do I need to use deflatemod?</h3><p>You need the camlzip library by Xavier Leroy and a working Ocsigen
installation.
</p><h3> How do I use deflatemod?</h3><p>First, load the extension in the configuration file:
</p><pre>&lt;extension findlib-package=&quot;ocsigenserver.ext.deflatemod&quot; /&gt;
</pre><p>Alternatively, if you do not want to use findlib, you need to:
</p><ul><li> load camlzip
</li></ul><pre>&lt;extension module=&quot;/path/to/camlzip.cma&quot; /&gt;
</pre><ul><li> then load deflatemod
</li></ul><pre>&lt;extension module=&quot;/path/to/deflatemod.cmo&quot; /&gt;
</pre><h3> How do I configure deflatemod?</h3><p>Again, the options are in ocsigen.conf. You can set a few options globally, in the extension tag:
</p><ul><li> the compress level: from 0 (no compression) to 9. The higher, the
better compression rate you achieve. Conversely, the lower, the faster
it is. Default is 6.
</li><li> the buffer size: default is 1024. You shouldn't need to change this
one, but you can still try a few other values (any feedback welcomed).
</li></ul><p>For example:
</p><pre>&lt;extension module=&quot;/home/gabriel/ocsigen/extensions/deflatemod.cmo&quot;&gt;
&lt;compress level=&quot;6&quot; /&gt;
&lt;buffer size=&quot;1024&quot; /&gt;
&lt;/extension&gt;
</pre><p>Next, you '''have to''' specify which pages you whish to deflate, in which host/site (otherwise, deflatemod won't compress anything). See next question to do that.
</p><h3> I want to deflate only some files. Is it possible?</h3><p>To some extent, yes. You can '''exclude''' some files and deflate every other, according to their mime-type or extension (''ie.'' the end of the '''url''' in fact, not really the file name on the disk).
</p><p>Here is an example:
</p><pre>&lt;host&gt;
&lt;site&gt;
&lt;!-- ... --&gt;
&lt;/site&gt;

&lt;deflate compress=&quot;allbut&quot;&gt;
&lt;!-- deflate everything but *.tar.gz files and image/* files --&gt;
    &lt;extension&gt;.tar.gz&lt;/extension&gt;
    &lt;type&gt;image/*&lt;/type&gt;
&lt;/deflate&gt;
&lt;/host&gt;
</pre><p>As you can see, you must put the &lt;deflate&gt; tag at the very end of the &lt;host&gt; element. Indeed, Ocsigen deals with extensions sequentially, so if you put &lt;site&gt; or other elements '''after''' &lt;deflatemod&gt;, they won't be compressed.
</p><p>Conversely, you can choose to deflate '''only''' some files, based
on their mime-types or extension:
</p><pre>&lt;host&gt;
&lt;site&gt;
&lt;!-- ... --&gt;
&lt;/site&gt;

&lt;deflate compress=&quot;only&quot;&gt;
&lt;!-- deflate only text/html files --&gt;
    &lt;type&gt;text/html&lt;/type&gt;
&lt;/deflate&gt;
&lt;/host&gt;
</pre><p>Warning: you can use only one contenttype tag! So you must choose,
either the &quot;only&quot; or the &quot;allbut&quot; way.
</p><p>Limitations: you cannot filter by directory or by filename extension (remember extension is the url's extension). If you really need it, please fill a bug report or send a patch.
</p><h2> Technical questions </h2><h3> How can I choose the content-encoding (gzip or deflate)?</h3><p>You can't. Deflatemod follows the RFC and chooses automatically the
right encoding, based upon Accept-encoding header sent by the client.
</p><h3> Does deflatemod support transfert-encoding?</h3><p>No, it  doesn't. Content-encoding is definitely a better solution,
providing end to end compression at the content-level.
</p><h3> How does deflatemod deal with the content-length header?</h3><p>As it cannot compute the new content-length, deflatemod uses
chunked-encoding. This is the recommended way to go.
</p><p><em>Page written by Gabriel Kerneis</em>
</p></article></div></div></body></html>
