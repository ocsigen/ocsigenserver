<html><head><title>Module Ocsigen_extensions </title><meta charset="utf8"/><link rel="stylesheet" href="https://ocsigen.org/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script type="text/javascript" src="https://ocsigen.org/js/client.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js">
//<![CDATA[

//]]>
</script></head><body><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href=".././../../" class="ocsimore_phrasing_link"><img src=".././../../img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Server</p><div class="mainmenu"><p class="mainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a></p><p class="mainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a></p><p><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a></p><p><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a></p><p><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a></p><p><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a></p><p><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a></p></div><form id="googlesearch" action="https://google.com/search"><input name="q" id="gsearch-box" placeholder="Search using Google"/><label for="gsearch-box"><img src="/img/search.svg" alt="" id="gsearch-icon"/></label><input type="submit" id="gsearch-submit" onclick="document.getElementById('gsearch-box').value += ' site:ocsigen.org';"/></form><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigenserver/" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-toolkit/" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-project"><a href=".././../../html_of_wiki/" class="ocsimore_phrasing_link">html_of_wiki</a>
</li><li class="drawermainmenu-project"><a href=".././../../deriving/" class="ocsimore_phrasing_link">deriving</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsimore/" class="ocsimore_phrasing_link">Ocsimore (<em>deprecated</em>)</a>
</li><li class="drawermainmenu-page"><a href=".././../../projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href=".././../../papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href=".././../../credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href=".././../../contributing" class="ocsimore_phrasing_link">Contributing</a>
</li><li class="drawermainmenu-page"><a href=".././../../blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"><h1>Ocsigen server - API reference</h1><h2>Persistent data, writing in the logs, configuration file extension, polymorphic tables</h2><h3><a href=".././api/Ocsigen_messages" class="ocsimore_phrasing_link">Ocsigen_messages</a></h3><h3><a href=".././api/Ocsigen_parseconfig" class="ocsimore_phrasing_link">Ocsigen_parseconfig</a></h3><h3><a href=".././api/Polytables" class="ocsimore_phrasing_link">Polytables</a></h3><h3><a href=".././api/Ocsigen_cache" class="ocsimore_phrasing_link">Ocsigen_cache</a></h3><h3><a href=".././api/Ocsipersist" class="ocsimore_phrasing_link">Ocsipersist</a></h3><h2>Extending Ocsigen</h2><h3><a href=".././api/Ocsigen_extensions" class="ocsimore_phrasing_link">Ocsigen_extensions</a></h3><h3><a href=".././api/Ocsigen_headers" class="ocsimore_phrasing_link">Ocsigen_headers</a></h3><h3><a href=".././api/Ocsigen_senders" class="ocsimore_phrasing_link">Ocsigen_senders</a></h3><h3><a href=".././api/Ocsigen_http_frame" class="ocsimore_phrasing_link">Ocsigen_http_frame</a></h3><h3><a href=".././api/Ocsigen_http_client" class="ocsimore_phrasing_link">Ocsigen_http_client</a></h3><h3><a href=".././api/Ocsigen_http_com" class="ocsimore_phrasing_link">Ocsigen_http_com</a></h3><h3><a href=".././api/Ocsigen_stream" class="ocsimore_phrasing_link">Ocsigen_stream</a></h3><h3><a href=".././api/Ocsigen_comet" class="ocsimore_phrasing_link">Ocsigen_comet</a></h3><h3><a href=".././api/Authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h2>Indexes</h2><h3> <span><a href=".././api/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/index_methods">Index of class methods</a></span></h3><h3> <span><a href=".././api/index_classes">Index of classes</a></span></h3><h3> <span><a href=".././api/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/index_module_types">Index of module types</a></span></h3></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value=".././../1.1.0/api/Ocsigen_extensions">1.1.0</option><option value=".././../1.2.2/api/Ocsigen_extensions">1.2.2</option><option value=".././../1.3.4/api/Ocsigen_extensions">1.3.4</option><option value=".././../2.1/api/Ocsigen_extensions" selected="selected">2.1</option><option value=".././../2.2/api/Ocsigen_extensions">2.2</option><option value=".././../2.3/api/Ocsigen_extensions">2.3</option><option value=".././../2.5/api/Ocsigen_extensions">2.5</option><option value=".././../2.6/api/Ocsigen_extensions">2.6</option><option value=".././../2.7/api/Ocsigen_extensions">2.7</option><option value=".././../2.8/api/Ocsigen_extensions">2.8</option><option value=".././../2.9/api/Ocsigen_extensions">2.9</option><option value=".././../dev/api/Ocsigen_extensions">dev</option></select><nav class="how-doctree"><h1>Ocsigen server - API reference</h1><h2>Persistent data, writing in the logs, configuration file extension, polymorphic tables</h2><h3><a href=".././api/Ocsigen_messages" class="ocsimore_phrasing_link">Ocsigen_messages</a></h3><h3><a href=".././api/Ocsigen_parseconfig" class="ocsimore_phrasing_link">Ocsigen_parseconfig</a></h3><h3><a href=".././api/Polytables" class="ocsimore_phrasing_link">Polytables</a></h3><h3><a href=".././api/Ocsigen_cache" class="ocsimore_phrasing_link">Ocsigen_cache</a></h3><h3><a href=".././api/Ocsipersist" class="ocsimore_phrasing_link">Ocsipersist</a></h3><h2>Extending Ocsigen</h2><h3><a href=".././api/Ocsigen_extensions" class="ocsimore_phrasing_link">Ocsigen_extensions</a></h3><h3><a href=".././api/Ocsigen_headers" class="ocsimore_phrasing_link">Ocsigen_headers</a></h3><h3><a href=".././api/Ocsigen_senders" class="ocsimore_phrasing_link">Ocsigen_senders</a></h3><h3><a href=".././api/Ocsigen_http_frame" class="ocsimore_phrasing_link">Ocsigen_http_frame</a></h3><h3><a href=".././api/Ocsigen_http_client" class="ocsimore_phrasing_link">Ocsigen_http_client</a></h3><h3><a href=".././api/Ocsigen_http_com" class="ocsimore_phrasing_link">Ocsigen_http_com</a></h3><h3><a href=".././api/Ocsigen_stream" class="ocsimore_phrasing_link">Ocsigen_stream</a></h3><h3><a href=".././api/Ocsigen_comet" class="ocsimore_phrasing_link">Ocsigen_comet</a></h3><h3><a href=".././api/Authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h2>Indexes</h2><h3> <span><a href=".././api/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/index_methods">Index of class methods</a></span></h3><h3> <span><a href=".././api/index_classes">Index of classes</a></span></h3><h3> <span><a href=".././api/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/index_module_types">Index of module types</a></span></h3></nav></nav><article class="rightcol"><h1>Module <span><a href=".././api/Ocsigen_extensions">Ocsigen_extensions</a></span> </h1><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span class="ocsforge_color_uid"><span class="ocsforge_color_uid">Ocsigen_extensions</span></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a href=".././api/Ocsigen_extensions">..</a></span><span class="ocsforge_color_keyword">end</span></pre><p>Writing extensions for Ocsigen
</p><hr/><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONOcsigen_http_error"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Ocsigen_http_error</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></pre><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONBad_config_tag_for_extension"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Bad_config_tag_for_extension</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">string</span></pre><div class="odocwiki_info"><p>Xml tag not recognized by an extension (usually not a real error)</p></div><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONError_in_config_file"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Error_in_config_file</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">string</span></pre><div class="odocwiki_info"><p>Error in a &lt;site&gt; tag inside the main ocsigen.conf file</p></div><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONError_in_user_config_file"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Error_in_user_config_file</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">string</span></pre><div class="odocwiki_info"><p>Option incorrect in a userconf file</p></div><pre class="ocsforge_color odocwiki_code" id="VALbadconfig"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">badconfig</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'a, unit, string, 'b<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Pervasives</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">format4</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a</span></pre><div class="odocwiki_info"><p>Convenient function for raising Error_in_config_file exceptions with
a sprintf-formatted argument.</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEvirtual_hosts"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">virtual_hosts</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>string * <span class="ocsforge_color_uid">Netstring_pcre</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">regexp</span> * int option<span class="ocsforge_color_delimiter">)</span> list</span></pre><div class="odocwiki_info"><p>Type of the result of parsing the field <span class="odocwiki_inlinecode">hostfiler</span> in the configuration
file. Inside the list, the first argument is the host itself
(which is a glob-like pattern that can contains <span class="odocwiki_inlinecode">*</span>), a regexp
parsing this pattern, and optionnaly a port.</p></div><pre class="ocsforge_color odocwiki_code" id="VALhash_virtual_hosts"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">hash_virtual_hosts</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><pre class="ocsforge_color odocwiki_code" id="VALequal_virtual_hosts"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">equal_virtual_hosts</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> bool</span></pre><pre class="ocsforge_color odocwiki_code" id="VALhost_match"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">host_match</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">virtual_hosts:</span><span><a href=".././api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">host:</span>string option <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_label">port:</span>int <span class="ocsforge_color_delimiter">-&gt;</span> bool</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEdo_not_serve"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">do_not_serve</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_regexps:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_files:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_extensions:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><div class="odocwiki_info"><p>Configuration to hide/forbid local files</p></div><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONIncorrectRegexpes"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">IncorrectRegexpes</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALdo_not_serve_to_regexp"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">do_not_serve_to_regexp</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_uid">Netstring_pcre</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">regexp</span></span></pre><div class="odocwiki_info"><p>Compile a do_not_serve structure into a regexp. Raises
<span class="odocwiki_inlinecode">IncorrectRegexpes</span> if the compilation fails. The result is
memoized for subsequent calls with the same argument</p></div><pre class="ocsforge_color odocwiki_code" id="VALjoin_do_not_serve"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">join_do_not_serve</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEconfig_info"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">config_info</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_hostname:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_httpport:</span> <span class="odocwiki_type">int</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_httpsport:</span> <span class="odocwiki_type">int</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">mime_assoc:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_charset_mime#TYPEmime_assoc">Ocsigen_charset_mime.mime_assoc</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">charset_assoc:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_charset_mime#TYPEcharset_assoc">Ocsigen_charset_mime.charset_assoc</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_directory_index:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">list_directory_content:</span> <span class="odocwiki_type">bool</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">follow_symlinks:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEfollow_symlink">follow_symlink</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_404:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_403:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">uploaddir:</span> <span class="odocwiki_type">string option</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">maxuploadfilesize:</span> <span class="odocwiki_type">int64 option</span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><div class="odocwiki_info"><p>Configuration options, passed to (and modified by) extensions</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEfollow_symlink"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">follow_symlink</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_variants"><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">DoNotFollowSymlinks</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Never follow a symlink</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">FollowSymlinksIfOwnerMatch</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Follow a symlink if the symlink and its
target have the same owner</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">AlwaysFollowSymlinks</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Always follow symlinks</span><span class="odocwiki_comments_close"> *)</span></span></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEclient"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">client</span></pre><div class="odocwiki_info"><p>A value of this type represents the client who did the request.</p></div><pre class="ocsforge_color odocwiki_code" id="VALclient_id"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">client_id</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEclient">client</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><div class="odocwiki_info"><p>Returns the id number of the connection</p></div><pre class="ocsforge_color odocwiki_code" id="VALclient_connection"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">client_connection</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEclient">client</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_http_com#TYPEconnection">Ocsigen_http_com.connection</a></span></span></pre><div class="odocwiki_info"><p>Returns the connection</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEifrange"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">ifrange</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_variants"><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">IR_No</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">IR_Ifunmodsince</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">float</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">IR_ifmatch</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">string</span></span></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEfile_info"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">file_info</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">tmp_filename:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">filesize:</span> <span class="odocwiki_type">int64</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">raw_original_filename:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">original_basename:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">file_content_type:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>string * string option<span class="ocsforge_color_delimiter">)</span> option</span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPErequest_info"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">request_info</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_url_string:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>full URL</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_method:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_http_frame.Http_header#TYPEhttp_method">Ocsigen_http_frame.Http_header.http_method</a></span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>GET, POST, HEAD...</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_protocol:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_http_frame.Http_header#TYPEproto">Ocsigen_http_frame.Http_header.proto</a></span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>HTTP protocol used by client</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_ssl:</span> <span class="odocwiki_type">bool</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>true if HTTPS, false if HTTP</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_full_path_string:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>full path of the URL</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_full_path:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>full path of the URL</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_original_full_path_string:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>full path of the URL, as first sent by the client. Should not be changed by extensions, even rewritemod. It is used to create relative links.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_original_full_path:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>full path of the URL, as first sent by the client. See below.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_sub_path:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>path of the URL (only part concerning the site)</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_sub_path_string:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>path of the URL (only part concerning the site)</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_get_params_string:</span> <span class="odocwiki_type">string option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>string containing GET parameters</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_host:</span> <span class="odocwiki_type">string option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Host field of the request (if any), without port</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_port_from_host_field:</span> <span class="odocwiki_type">int option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Port in the host field of the request (if any)</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_get_params:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>string * string<span class="ocsforge_color_delimiter">)</span> list <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Association list of get parameters</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_initial_get_params:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>string * string<span class="ocsforge_color_delimiter">)</span> list <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Association list of get parameters, as sent by the browser (must not be modified by extensions)</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_post_params:</span> <span class="odocwiki_type"><br/>    <span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_extensions#TYPEconfig_info">config_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_delimiter">(</span>string * string<span class="ocsforge_color_delimiter">)</span> list <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span><br/>    option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Association list of post parameters, if urlencoded form parameters or multipart data. None if other content type or no content.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_files:</span> <span class="odocwiki_type"><br/>    <span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_extensions#TYPEconfig_info">config_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>     <span class="ocsforge_color_delimiter">(</span>string * <span><a href=".././api/Ocsigen_extensions#TYPEfile_info">file_info</a></span><span class="ocsforge_color_delimiter">)</span> list <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span><br/>    option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Files sent in the request (multipart data). None if other content type or no content.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_remote_inet_addr:</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Unix</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">inet_addr</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>IP of the client</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_remote_ip:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>IP of the client</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_remote_ip_parsed:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_lib.Ip_address#TYPEt">Ocsigen_lib.Ip_address.t</a></span> <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>IP of the client, parsed</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_remote_port:</span> <span class="odocwiki_type">int</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Port used by the client</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_forward_ip:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>IPs of gateways the request went throught</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_server_port:</span> <span class="odocwiki_type">int</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Port of the request (server)</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_user_agent:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>User_agent of the browser</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_cookies_string:</span> <span class="odocwiki_type">string option <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Cookies sent by the browser</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_cookies:</span> <span class="odocwiki_type">string <span class="ocsforge_color_uid">Ocsigen_cookies</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_uid">CookiesTable</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span> <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Cookies sent by the browser</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_ifmodifiedsince:</span> <span class="odocwiki_type">float option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>if-modified-since field</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_ifunmodifiedsince:</span> <span class="odocwiki_type">float option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>if-unmodified-since field</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_ifnonematch:</span> <span class="odocwiki_type">string list option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>if-none-match field ( * and weak entity tags not implemented)</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_ifmatch:</span> <span class="odocwiki_type">string list option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>if-match field ( * not implemented)</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_content_type:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_delimiter">(</span>string * string<span class="ocsforge_color_delimiter">)</span> * <span class="ocsforge_color_delimiter">(</span>string * string<span class="ocsforge_color_delimiter">)</span> list<span class="ocsforge_color_delimiter">)</span> option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Content-Type HTTP header</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_content_type_string:</span> <span class="odocwiki_type">string option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Content-Type HTTP header</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_content_length:</span> <span class="odocwiki_type">int64 option</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Content-Length HTTP header</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_referer:</span> <span class="odocwiki_type">string option <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Referer HTTP header</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_origin:</span> <span class="odocwiki_type">string option <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Where the cross-origin request or preflight request originates from.
http://www.w3.org/TR/cors/#origin-request-header</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_access_control_request_method:</span> <span class="odocwiki_type">string option <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>which method will be used in the actual request as part of
the preflight request.
http://www.w3.org/TR/cors/#access-control-request-method-request-he</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_access_control_request_headers:</span> <span class="odocwiki_type">string list option <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Which headers will be used in the actual request as part of
the preflight request.
http://www.w3.org/TR/cors/#access-control-request-headers-request-h</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_accept:</span> <span class="odocwiki_type"><br/>    <span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_delimiter">(</span>string option * string option<span class="ocsforge_color_delimiter">)</span> * float option *<br/>     <span class="ocsforge_color_delimiter">(</span>string * string<span class="ocsforge_color_delimiter">)</span> list<span class="ocsforge_color_delimiter">)</span><br/>    list <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Accept HTTP header. For example <span class="odocwiki_inlinecode">(Some &quot;text&quot;, None)</span> means <span class="odocwiki_inlinecode">&quot;text/*&quot;</span>. The float is the &quot;quality&quot; value, if any. The last association list is for other extensions.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_accept_charset:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>string option * float option<span class="ocsforge_color_delimiter">)</span> list <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Accept-Charset HTTP header. <span class="odocwiki_inlinecode">None</span> for the first value means &quot;*&quot;. The float is the &quot;quality&quot; value, if any.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_accept_encoding:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>string option * float option<span class="ocsforge_color_delimiter">)</span> list <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Accept-Encoding HTTP header. <span class="odocwiki_inlinecode">None</span> for the first value means &quot;*&quot;. The float is the &quot;quality&quot; value, if any.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_accept_language:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>string * float option<span class="ocsforge_color_delimiter">)</span> list <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Accept-Language HTTP header. The float is the &quot;quality&quot; value, if any.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_http_frame:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_http_frame#TYPEt">Ocsigen_http_frame.t</a></span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>The full http_frame</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_keyword">mutable </span><span class="ocsforge_color_label">ri_request_cache:</span> <span class="odocwiki_type"><span><a href=".././api/Polytables#TYPEt">Polytables.t</a></span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Use this to put anything you want,
for example, information for subsequent
extensions</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_client:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEclient">client</a></span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>The request connection</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_range:</span> <span class="odocwiki_type"><br/>    <span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_delimiter">(</span>int64 * int64<span class="ocsforge_color_delimiter">)</span> list * int64 option * <span><a href=".././api/Ocsigen_extensions#TYPEifrange">ifrange</a></span><span class="ocsforge_color_delimiter">)</span><br/>    option <span class="ocsforge_color_uid">Lazy</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Range HTTP header. <span class="odocwiki_inlinecode">None</span> means all the document. 
List of intervals + possibly from an index to the end of the document.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_timeofday:</span> <span class="odocwiki_type">float</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>An Unix timestamp computed at the beginning of the request</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_keyword">mutable </span><span class="ocsforge_color_label">ri_nb_tries:</span> <span class="odocwiki_type">int</span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>For internal use: 
used to prevent loops of requests</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">ri_connection_closed:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span><span class="ocsforge_color_delimiter">;</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>a thread waking up when the connection is closed</span><span class="odocwiki_comments_close"> *)</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><div class="odocwiki_info"><p>The request
</p><p>If you force <span class="odocwiki_inlinecode">ri_files</span> or <span class="odocwiki_inlinecode">ri_post_params</span>, the request is fully read,
so it is not possible any more to read it from <span class="odocwiki_inlinecode">ri_http_frame</span>
(and vice versa).</p></div><pre class="ocsforge_color odocwiki_code" id="TYPErequest"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">request</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">request_info:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPErequest_info">request_info</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">request_config:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEconfig_info">config_info</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONOcsigen_Is_a_directory"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Ocsigen_Is_a_directory</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEanswer"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">answer</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_variants"><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_do_nothing</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>I don't want to do anything</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_found</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&quot;OK stop! I will take the page.
You can start the following request of the same pipelined connection.
Here is the function to generate the page&quot;.
The extension must return Ext_found as soon as possible
when it is sure it is safe to start next request.
Usually as soon as you know that the result will be Ext_found.
But in some case, for example proxies, you don't want the request of
one connection to be handled in different order.
In that case, wait to be sure that the new request will not
overtake this one.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_found_stop</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Found but do not try next extensions</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_next</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">int</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Page not found. Try next extension.
The integer is the HTTP error code.
It is usally 404, but may be for ex 403 (forbidden)
if you want another extension to try after a 403.
Same as Ext_continue_with but does not change
the request.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_stop_site</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Error. Do not try next extension, but
try next site.
The integer is the HTTP error code, usally 403.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_stop_host</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Error. Do not try next extension,
do not try next site,
but try next host.
The integer is the HTTP error code, usally 403.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_stop_all</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Error. Do not try next extension (even filters),
do not try next site,
do not try next host,
do not .
The integer is the HTTP error code, usally 403.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_continue_with</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span> * <span><a href=".././api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Used to modify the request before giving it to next extension.
The extension returns the request_info (possibly modified)
and a set of cookies if it wants to set or cookies
(<span class="odocwiki_inlinecode">!Ocsigen_cookies.Cookies.empty</span> for no cookies).
You must add these cookies yourself in request_info if you
want them to be seen by subsequent extensions,
for example using <span><a href=".././api/Ocsigen_http_frame#VALcompute_new_ri_cookies">Ocsigen_http_frame.compute_new_ri_cookies</a></span>.
The integer is usually equal to the error code received
from preceding extension (but you may want to modify it).</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_retry_with</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span> * <span><a href=".././api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Used to retry all the extensions with a new request_info.
The extension returns the request_info (possibly modified)
and a set of cookies if it wants to set or cookies
(<span class="odocwiki_inlinecode">!Ocsigen_cookies.Cookies.empty</span> for no cookies).
You must add these cookies yourself in request_info if you
want them to be seen by subsequent extensions,
for example using <span><a href=".././api/Ocsigen_http_frame#VALcompute_new_ri_cookies">Ocsigen_http_frame.compute_new_ri_cookies</a></span>.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_sub_result</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEextension2">extension2</a></span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Used if your extension want to define option that may contain
other options from other extensions.
In that case, while parsing the configuration file, call
the parsing function (of type <span class="odocwiki_inlinecode">parse_fun</span>),
that will return something of type <span class="odocwiki_inlinecode">extension2</span>.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_found_continue_with</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><br/>    <span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span><br/>     <span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span> * <span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Same as <span class="odocwiki_inlinecode">Ext_found</span> but may modify the request.</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_found_continue_with'</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span> * <span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span><span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>Same as <span class="odocwiki_inlinecode">Ext_found_continue_with</span> but does not allow to delay
the computation of the page. You should probably not use it,
but for output filters.</span><span class="odocwiki_comments_close"> *)</span></span></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPErequest_state"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">request_state</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_variants"><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Req_not_found</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>int * <span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span><span class="ocsforge_color_delimiter">)</span></span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Req_found</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span> * <span><a href=".././api/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span><span class="ocsforge_color_delimiter">)</span></span></span></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEextension2"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">extension2</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_extensions#TYPErequest_state">request_state</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsigen_extensions#TYPEanswer">answer</a></span> * <span><a href=".././api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEextension"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">extension</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPErequest_state">request_state</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_extensions#TYPEanswer">answer</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>For each &lt;site&gt; tag in the configuration file,
you can set the extensions you want.
Each extension is implemented as a function, taking
the charset found in configuration file,
the current state of the request,
and returning an answer.
If no page has been generated so far (<span class="odocwiki_inlinecode">Req_not_found</span>), it receive
the error code given by the previous extension (default 404),
and the request information.
If a page has been generated by previous extensions (case <span class="odocwiki_inlinecode">Req_found</span>),
the extension may want to modify the result (filters).</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEparse_fun"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_fun</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Simplexmlparser</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">xml</span> list <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_extensions#TYPEextension2">extension2</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEparse_host"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_host</span></pre><div class="odocwiki_info"><p>Type of the functions parsing the content of a &lt;host&gt; tag</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEuserconf_info"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">userconf_info</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">localfiles_root:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><div class="odocwiki_info"><p>Information received by extensions accepting userconf files.
</p><p>The parameter <span class="odocwiki_inlinecode">localfiles_root</span> is an absolute path to the
directory that the user is allowed to serve. This is used
by staticmod, to disallow the user from allowing access to
outside of this directory</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEparse_config"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_config</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEconfig_info">config_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_extensions#TYPEparse_config_aux">parse_config_aux</a></span></span></pre><div class="odocwiki_info"><p><span class="odocwiki_inlinecode">parse_config</span> is the type of the functions parsing a &lt;site&gt; tag
(and returning an extension).  Those are functions taking

</p><ul><li> the name of the virtual &lt;host&gt;
</li></ul><p>that will be called for each &lt;host&gt;,
and that will generate a function taking:

</p><ul><li> the path attribute of a &lt;site&gt; tag
</li></ul><p>that will be called for each &lt;site&gt;,
and that will generate a function taking:

</p><ul><li> an item of the config file
</li></ul><p>that will be called on each tag inside &lt;site&gt; and:

</p><ul><li> raise <span class="odocwiki_inlinecode">Bad_config_tag_for_extension</span> if it does not recognize that tag
</li><li> return something of type <span class="odocwiki_inlinecode">extension</span> (filter or page generator)
</li></ul><p><span class="odocwiki_inlinecode">parse_config_user</span> is the type of functions parsing a site tag
inside an userconf file. They take one more parameter, of type userconf_info</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEparse_config_user"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_config_user</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPEuserconf_info">userconf_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_extensions#TYPEparse_config">parse_config</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEparse_config_aux"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_config_aux</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_uid">Ocsigen_lib</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_uid">Url</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">path</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEparse_host">parse_host</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEparse_fun">parse_fun</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_uid">Simplexmlparser</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">xml</span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_extensions#TYPEextension">extension</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALregister_extension"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">register_extension</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">name:</span>string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?fun_site:</span><span><a href=".././api/Ocsigen_extensions#TYPEparse_config">parse_config</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?user_fun_site:</span><span><a href=".././api/Ocsigen_extensions#TYPEparse_config_user">parse_config_user</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?begin_init:</span><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?end_init:</span><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?init_fun:</span><span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_uid">Simplexmlparser</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">xml</span> list <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?exn_handler:</span><span class="ocsforge_color_delimiter">(</span>exn <span class="ocsforge_color_delimiter">-&gt;</span> string<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_label">?respect_pipeline:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>For each extension generating pages, we register its name and six functions:
</p><ul><li> a function <span class="odocwiki_inlinecode">fun_site</span> of type <span class="odocwiki_inlinecode">parse_config</span>. This function
will be responsible for handling the options of the configuration
files that are recognized by the extension, and potentially generating
a page.
</li><li> a function <span class="odocwiki_inlinecode">user_fun_site</span> of type <span class="odocwiki_inlinecode">parse_user_config</span> which has the
same role as <span class="odocwiki_inlinecode">fun_site</span>, but inside userconf files. Specify nothing
if your extension is disallowed in userconf files. Otherwise, compared
to <span class="odocwiki_inlinecode">fun_site</span>, you can selectively disallow some options,
as <span class="odocwiki_inlinecode">user_fun_site</span> must define only safe options (for example it is not
safe to allow such options to load a cmo specified by a user, or to
execute a program, as this program will be executed by ocsigen's user).
Note that <span class="odocwiki_inlinecode">user_fun_site</span> will be called for every request, whereas the
<span class="odocwiki_inlinecode">fun_site</span> is called only when starting or reloading the server.
</li><li> a function <span class="odocwiki_inlinecode">begin_init</span> that will be called at the beginning
of the initialisation phase of each site, and each time the config file is
reloaded.
</li><li> a function <span class="odocwiki_inlinecode">end_init</span> that will be called at the end of the initialisation
phase of each site
</li><li> a function <span class="odocwiki_inlinecode">init_fun</span> that will be called just before registering the
extension, taking as parameter the configuration options between
<span class="odocwiki_inlinecode">&lt;extension&gt;</span> and <span class="odocwiki_inlinecode">&lt;/extension&gt;</span>. This allows to give configuration options
to extensions. If no function is supplied, the extension is supposed to
accept no option (and loading will fail if an option is supplied)
See &lt;&lt;a_api module=&quot;Ocsigen_extensions.Configuration&quot; | val process_elements &gt;&gt; for
the easy construction of such a function.
</li><li> a function <span class="odocwiki_inlinecode">exn_handler</span> that will create an error message from the
exceptions that may be raised during the initialisation phase, and raise again
all other exceptions
</li></ul><p>Moreover, if the optional parameter <span class="odocwiki_inlinecode">?respect_pipeline</span> is <span class="odocwiki_inlinecode">true</span>,
the extension will ask the server to respect the order of the
pipeline. That means that it will wait to be sure that the previous
request from the same connection has been taken by an extension
before giving a request to an extension.  Use this to write proxies
extensions, when you want to be able to pipeline the requests you
to another server. It is false by default.</p></div><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a href=".././api/Ocsigen_extensions.Configuration">Configuration</a></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a href=".././api/Ocsigen_extensions.Configuration">..</a></span><span class="ocsforge_color_keyword">end</span></pre><div class="odocwiki_info"><p>This modules contains types and constructor for the description of XML
configurations and the accordingly parsing.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_hostname"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_hostname</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> string</span></pre><div class="odocwiki_info"><p>Returns the hostname to be used for absolute links or redirections.
It is either the Host header or the hostname set in 
the configuration file.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_port"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_port</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsigen_extensions#TYPErequest">request</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><div class="odocwiki_info"><p>Returns the port to be used for absolute links or redirections.
It is either the port the server is listening at or the default port set in
the configuration file.</p></div><pre class="ocsforge_color odocwiki_code" id="VALri_of_url"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">ri_of_url</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">?full_rewrite:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_extensions#TYPErequest_info">request_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_extensions#TYPErequest_info">request_info</a></span></span></pre><div class="odocwiki_info"><p>Parsing URLs.
This allows to modify the URL in the request_info.
(to be used for example with Ext_retry_with or Ext_continue_with)</p></div><h3 id="3_Userdirectories">User directories <a class="backref" href="#3_Userdirectories">&#182;</a></h3><p>Exception raised when an non-existing user is found
</p><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONNoSuchUser"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">NoSuchUser</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEud_string"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">ud_string</span></pre><div class="odocwiki_info"><p>The type for string that may contain a $u(...)</p></div><pre class="ocsforge_color odocwiki_code" id="VALparse_user_dir"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">parse_user_dir</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">string <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Ocsigen_extensions#TYPEud_string">ud_string</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALreplace_user_dir"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">replace_user_dir</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_uid">Netstring_pcre</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">regexp</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a href=".././api/Ocsigen_extensions#TYPEud_string">ud_string</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> string <span class="ocsforge_color_delimiter">-&gt;</span> string</span></pre><div class="odocwiki_info"><p>raises <span class="odocwiki_inlinecode">Not_found</span> is the directory does not exist</p></div><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONNot_concerned"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Not_concerned</span></pre><div class="odocwiki_info"><h3 id="3_Regularexpressionsforredirections">Regular expressions for redirections <a class="backref" href="#3_Regularexpressionsforredirections">&#182;</a></h3></div><pre class="ocsforge_color odocwiki_code" id="VALfind_redirection"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">find_redirection</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_uid">Netstring_pcre</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">regexp</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  string option <span class="ocsforge_color_delimiter">-&gt;</span> int <span class="ocsforge_color_delimiter">-&gt;</span> string option <span class="ocsforge_color_delimiter">-&gt;</span> string <span class="ocsforge_color_delimiter">-&gt;</span> string <span class="ocsforge_color_delimiter">-&gt;</span> string</span></pre><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONUnknown_command"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Unknown_command</span></pre><div class="odocwiki_info"><h3 id="3_Extendingservercommands">Extending server commands <a class="backref" href="#3_Extendingservercommands">&#182;</a></h3></div><pre class="ocsforge_color odocwiki_code" id="VALregister_command_function"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">register_command_function</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">?prefix:</span>string <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_delimiter">(</span>string <span class="ocsforge_color_delimiter">-&gt;</span> string list <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Use a prefix for all your commands when you want to create
extension-specific commands. 
For example if the prefix is &quot;myextension&quot; and the commande &quot;blah&quot;,
the actual command to be written by the user is &quot;myextension:blah&quot;.
Give as parameter the function that will parse the command and do an action.
Its first parameter is the full command as a string.
The second one is the command without prefix, split by word.
It must raise <span class="odocwiki_inlinecode">ocsigen_extensions.Unknown_command</span> if it does
not recognize the command.</p></div></article></div></div></body></html>
