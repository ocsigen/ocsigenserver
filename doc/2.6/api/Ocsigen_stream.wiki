=Module <<a_api_type | module Ocsigen_stream >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Ocsigen_stream>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Ocsigen_stream >><<span class="ocsforge_color_keyword"|end>>>>~Streams are a means to read data block by block

----
<<pre id="EXCEPTIONInterrupted" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Interrupted>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|exn>>>><<pre id="EXCEPTIONCancelled" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Cancelled>>>><<pre id="EXCEPTIONAlready_read" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Already_read>>>><<pre id="EXCEPTIONFinalized" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Finalized>>>>
~Streams are a means to read data block by block
<<pre class="ocsforge_color odocwiki_code" id="TYPEstream"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_type"|'a>> <<span class="odocwiki_name"|stream>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEstep"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_type"|'a>> <<span class="odocwiki_name"|step>> <<span class="ocsforge_color_delimiter"|~=>> private <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Finished>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|'a <<a_api text="stream" | type Ocsigen_stream.stream >> option>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Cont>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|'a * 'a <<a_api text="stream" | type Ocsigen_stream.stream >>>>>>>>>>>><<div class="odocwiki_info"|~A stream may be composed by several substreams~.
    ~Thus a stream is either something that contains the current buffer and
    a function to retrieve the following data~,
    or a finished stream with possibly another stream following~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEt"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_type"|'a>> <<span class="odocwiki_name"|t>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEoutcome"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|outcome>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|[ `Failure | `Success ]>> >><<pre id="VALmake" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|make>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?finalize: >><<span class="ocsforge_color_delimiter"| ( >><<a_api text="outcome" | type Ocsigen_stream.outcome >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_stream.t >>>>>><<div class="odocwiki_info"|creates a new stream
>>
<<pre id="VALget" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_stream.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="stream" | type Ocsigen_stream.stream >>>>>><<div class="odocwiki_info"|call this function if you decide to start reading a stream~.
**Raises** {{{Already_read}}} if the stream has already been read~.\\
>>
<<pre id="VALnext" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|next>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="stream" | type Ocsigen_stream.stream >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|get the next step of a stream~.
    ~Fails with <<span class="odocwiki_inlinecode"|~Interrupted e>> if reading the thread failed with exception <<span class="odocwiki_inlinecode"|e>>~,
    and with <<span class="odocwiki_inlinecode"|~Cancelled>> if the thread has been cancelled~.
>>
<<pre id="VALempty" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|empty>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> option <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|creates an empty step~. ~The parameter is the following substream~, if any~.
>>
<<pre id="VALcont" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|cont>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  'a <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|creates a non empty step~.
>>
<<pre id="VALadd_finalizer" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add~_finalizer>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_stream.t >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_delimiter"| ( >><<a_api text="outcome" | type Ocsigen_stream.outcome >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|~Add a finalizer function~. ~In the current version~,
    finalizers must be called manually~.
>>
<<pre id="VALfinalize" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|finalize>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_stream.t >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="outcome" | type Ocsigen_stream.outcome >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Finalize the stream~. ~This function must be called explicitely after reading
    the stream~, otherwise finalizers won~'t be called~.
>>
<<pre id="VALcancel" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|cancel>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_stream.t >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Cancel the stream~, i~.e~. read the stream until the end~, without decoding~.
    ~Further tries to read on the stream will fail with exception
    <<a_api | exception Ocsigen_stream.Cancelled >>
>>
<<pre id="VALconsume" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|consume>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_stream.t >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Consume without cancelling~.
    ~Read the stream until the end~, without decoding~.
>>
<<pre id="EXCEPTIONStream_too_small" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Stream_too_small>>>><<div class="odocwiki_info"|possibly with the size of the stream
>>
<<pre id="EXCEPTIONStream_error" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Stream_error>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>><<pre id="EXCEPTIONString_too_large" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|String_too_large>>>><<pre id="VALstring_of_stream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|string~_of~_stream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|int <<span class="ocsforge_color_delimiter"| -> >> string <<a_api text="stream" | type Ocsigen_stream.stream >> <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Creates a string from a stream~. ~The first argument is the upper limit of the
    string length
>>
<<pre id="VALenlarge_stream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|enlarge~_stream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_delimiter"| -> >> string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Read more data in the buffer
>>
<<pre id="VALstream_want" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|stream~_want>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_delimiter"| -> >> int <<span class="ocsforge_color_delimiter"| -> >> string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|stream~_want s len>> ~Returns a stream with at least len
    bytes in the buffer if possible
>>
<<pre id="VALcurrent_buffer" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|current~_buffer>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_delimiter"| -> >> string>>>><<div class="odocwiki_info"|~Returns the value of the current buffer
>>
<<pre id="VALskip" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|skip>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_delimiter"| -> >>\\  int64 <<span class="ocsforge_color_delimiter"| -> >> string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Skips data~. ~Raises <<span class="odocwiki_inlinecode"|~Stream~_too~_small ~(~Some size~)>> 
    if the stream is too small~, where <<span class="odocwiki_inlinecode"|size>> is the size of the stream~.
>>
<<pre id="VALsubstream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|substream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  string <<span class="ocsforge_color_delimiter"| -> >>\\  string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_delimiter"| -> >> string <<a_api text="step" | type Ocsigen_stream.step >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Cut the stream at the position given by a string delimiter
>>
<<pre id="VALof_file" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|of~_file>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> string <<a_api text="t" | type Ocsigen_stream.t >>>>>><<div class="odocwiki_info"|returns a stream reading from a file~.
    ~Do not forget to finalize the stream to close the file~.
>>
<<pre id="VALof_string" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|of~_string>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> string <<a_api text="t" | type Ocsigen_stream.t >>>>>><<div class="odocwiki_info"|returns a stream containing a string~.
>>
<<pre id="VALof_lwt_stream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|of~_lwt~_stream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<span class="ocsforge_color_uid"|Lwt_stream>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_stream.t >>>>>><<div class="odocwiki_info"|~Convert a <<span class="odocwiki_inlinecode"|~Lwt~_stream~.t>> to an <<a_api | type Ocsigen_stream.t >>~.
>>
<<pre id="VALto_lwt_stream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|to~_lwt~_stream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_stream.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt_stream>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Convert an <<a_api | type Ocsigen_stream.t >> into a <<span class="odocwiki_inlinecode"|~Lwt~_stream~.t>>~.
>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api text="StringStream" | module Ocsigen_stream.StringStream >> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Ocsigen_stream.StringStream >><<span class="ocsforge_color_keyword"|end>>>>