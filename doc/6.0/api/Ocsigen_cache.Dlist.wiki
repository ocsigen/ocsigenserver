=Module <<a_api_type | module Ocsigen_cache.Dlist >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Dlist>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Ocsigen_cache.Dlist >><<span class="ocsforge_color_keyword"|end>>>>~Doubly~-linked lists with maximum number of entries~,
    and ~(possibly~) limited lifespan for entries~.

----
<<pre class="ocsforge_color odocwiki_code" id="TYPEt"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_type"|'a>> <<span class="odocwiki_name"|t>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEnode"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_type"|'a>> <<span class="odocwiki_name"|node>>>><<pre id="VALcreate" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|create>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| ?timer: >>float <<span class="ocsforge_color_delimiter"| -> >> int <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >>>>>><<div class="odocwiki_info"|~Create a dlist~. ~It takes the maximum length of the list as
      parameter~. ~The optional <<span class="odocwiki_inlinecode"|~?timer>> parameter sets a maximum
      lifetime for elements ~(in seconds~)~.
>>
<<pre id="VALadd" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a option>>>><<div class="odocwiki_info"|~Adds an element to the list~,
      and possibly returns the element that has been removed if the maximum
      size was exceeded~.
>>
<<pre id="VALremove" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|remove>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|~Removes an element from its list~.
      ~If it is not in a list~, it does nothing~.
      ~If it is in a list~, it calls the finaliser~, then removes the element~.
      ~If the finaliser fails with an exception~,
      the element is removed and the exception is raised again~.
>>
<<pre id="VALup" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|up>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|~Removes the element from its list without finalising~,
      then adds it as newest~.
>>
<<pre id="VALnewest" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|newest>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> option>>>><<pre id="VALoldest" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|oldest>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> option>>>><<pre id="VALsize" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|size>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<pre id="VALmaxsize" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|maxsize>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<pre id="VALvalue" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|value>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> 'a>>>><<pre id="VALget_timer" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_timer>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> float option>>>><<div class="odocwiki_info"|returns the timer of the ~Dlist
>>
<<pre id="VALlist_of" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|list~_of>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> option>>>><<div class="odocwiki_info"|~The list to which the node belongs
>>
<<pre id="VALremove_n_oldest" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|remove~_n~_oldest>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> int <<span class="ocsforge_color_delimiter"| -> >> 'a list>>>><<div class="odocwiki_info"|remove the n oldest values ~(or less if the list is not long enough~) ~;
      returns the list of removed values
>>
<<pre id="VALfold" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|fold>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_delimiter"| -> >> 'b<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'b>>>><<div class="odocwiki_info"|fold over the elements from the cache starting from the newest
      to the oldest
>>
<<pre id="VALfold_back" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|fold~_back>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_delimiter"| -> >> 'b<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'b>>>><<div class="odocwiki_info"|fold over the elements from the cache starting from the oldest
      to the newest
>>
<<pre id="VALlwt_fold" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|lwt~_fold>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|lwt version of fold
>>
<<pre id="VALlwt_fold_back" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|lwt~_fold~_back>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|lwt version of fold~_back
>>
<<pre id="VALmove" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|move>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a option>>>><<div class="odocwiki_info"|~Move a node from one dlist to another one~, without finalizing~.
      ~If one value is removed from the destination list ~(because its
      maximum size is reached~)~, it is returned ~(after finalisation~)~.
>>
<<pre id="VALset_maxsize" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_maxsize>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> int <<span class="ocsforge_color_delimiter"| -> >> 'a list>>>><<div class="odocwiki_info"|change the maximum size ~;
      returns the list of removed values~, if any~.
>>
<<pre id="VALset_finaliser_before" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_finaliser~_before>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|set a function to be called automatically on a piece of data
      just before it disappears from the list
      ~(either by explicit removal or because the maximum size is exceeded~)
>>
<<pre id="VALget_finaliser_before" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_finaliser~_before>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALadd_finaliser_before" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add~_finaliser~_before>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALset_finaliser_after" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_finaliser~_after>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|set a function to be called automatically on a piece of data
      just after it disappears from the list
      ~(either by explicit removal or because the maximum size is exceeded~)
>>
<<pre id="VALget_finaliser_after" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_finaliser~_after>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALadd_finaliser_after" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add~_finaliser~_after>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<a_api text="node" | type Ocsigen_cache.Dlist.node >> <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<a_api text="t" | type Ocsigen_cache.Dlist.t >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>>