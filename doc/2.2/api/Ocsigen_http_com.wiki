=Module <<a_api_type | module Ocsigen_http_com >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Ocsigen_http_com>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Ocsigen_http_com >><<span class="ocsforge_color_keyword"|end>>>>~Sending and receiving ~H~T~T~P frames

----
<<pre id="EXCEPTIONConnection_closed" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Connection_closed>>>><<div class="odocwiki_info"|~The other side has cleanly closed the connection after a message
>>
<<pre id="EXCEPTIONLost_connection" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Lost_connection>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|exn>>>><<div class="odocwiki_info"|~The connection has been unexpectedly broken
>>
<<pre id="EXCEPTIONTimeout" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Timeout>>>><<div class="odocwiki_info"|~No activity on the other side
>>
<<pre id="EXCEPTIONKeepalive_timeout" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Keepalive_timeout>>>><<pre id="EXCEPTIONAborted" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Aborted>>>><<div class="odocwiki_info"|~Connection killed
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEmode"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|mode>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Answer>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Query>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Nofirstline>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEconnection"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|connection>>>><<pre id="VALcreate_receiver" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|create~_receiver>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  int <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="mode" | type Ocsigen_http_com.mode >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Lwt_ssl>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|socket>> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="connection" | type Ocsigen_http_com.connection >>>>>><<pre id="VALlock_receiver" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|lock~_receiver>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALunlock_receiver" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|unlock~_receiver>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALwakeup_next_request" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|wakeup~_next~_request>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALblock_next_request" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|block~_next~_request>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALget_http_frame" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_http~_frame>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?head: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Ocsigen_http_frame.t" | type Ocsigen_http_frame.t >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALconnection_id" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|connection~_id>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<pre id="VALconnection_fd" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|connection~_fd>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Lwt_ssl>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|socket>>>>>><<pre id="VALclosed" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|closed>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|closed conn>> is a thread waking up when the connection is
    closed
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEslot"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|slot>>>><<pre id="VALstart_processing" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|start~_processing>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api text="slot" | type Ocsigen_http_com.slot >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALwait_all_senders" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|wait~_all~_senders>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALwrite_stream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|write~_stream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?chunked: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_uid"|Lwt_chan>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|out_channel>> <<span class="ocsforge_color_delimiter"| -> >> string <<a_api text="Ocsigen_stream.t" | type Ocsigen_stream.t >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~This function may return any ~I~/~O error from the channel~, or a
interrupted stream exception~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEsender_type"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|sender~_type>>>><<pre id="VALcreate_sender" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|create~_sender>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?server_name: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?headers: >><<a_api text="Http_headers.t" | type Http_headers.t >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?proto: >><<a_api text="Ocsigen_http_frame.Http_header.proto" | type Ocsigen_http_frame.Http_header.proto >> <<span class="ocsforge_color_delimiter"| -> >>\\  unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="sender_type" | type Ocsigen_http_com.sender_type >>>>>><<pre id="VALdefault_sender" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|default~_sender>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="sender_type" | type Ocsigen_http_com.sender_type >>>>>><<div class="odocwiki_info"|~Sender with only the server name~, and ~H~T~T~P~/~1~.~1
>>
<<pre id="VALsend" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|send>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?reopen: >><<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="slot" | type Ocsigen_http_com.slot >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| clientproto: >><<a_api text="Ocsigen_http_frame.Http_header.proto" | type Ocsigen_http_frame.Http_header.proto >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?mode: >><<a_api text="Ocsigen_http_frame.Http_header.http_mode" | type Ocsigen_http_frame.Http_header.http_mode >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?proto: >><<a_api text="Ocsigen_http_frame.Http_header.proto" | type Ocsigen_http_frame.Http_header.proto >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?keep_alive: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| head: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| sender: >><<a_api text="sender_type" | type Ocsigen_http_com.sender_type >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="Ocsigen_http_frame.result" | type Ocsigen_http_frame.result >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|send an ~H~T~T~P message~.
    <<span class="odocwiki_inlinecode"|send>> may also fail with <<span class="odocwiki_inlinecode"|~Interrupted~_stream>> exception if the input
    stream is interrupted~.
>>
<<pre id="VALabort" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|abort>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALset_result_observer" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_result~_observer>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_http_frame.Http_header.http_header" | type Ocsigen_http_frame.Http_header.http_header >> <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  unit>>>><<div class="odocwiki_info"|~Use this function to make an action just before sending the result 
    ~(for example observe the headers that will be sent~)~.
    ~The parameter is a function taking the set of headers twice~,
    first as <<span class="odocwiki_inlinecode"|~Ocsigen~_http~_frame~.~Http~_headers~.http~_header>>~, 
    second as a <<span class="odocwiki_inlinecode"|string>>~.
>>
