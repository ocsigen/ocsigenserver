<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Revproxy</title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js"></script><script src="/js/client.js"></script></head><body class="ocsigenserver 2.8 revproxy"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href="/" class="ocsimore_phrasing_link"><img src="/img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Server
</p><ul class="mainmenu"><li class="mainmenu-home"><a href="/" class="ocsimore_phrasing_link">Home</a>
</li><li class="mainmenu-doc"><a href="/tuto/6.2/manual/intro" class="ocsimore_phrasing_link">Doc</a>
</li><li><a href="/eliom/6.3/manual/intro" class="ocsimore_phrasing_link">Eliom</a>
</li><li><a href="/js_of_ocaml/3.1.0/manual/overview" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li><a href="/lwt/3.2.1/manual/manual" class="ocsimore_phrasing_link">Lwt</a>
</li><li><a href="/tyxml/4.1.0/manual/intro" class="ocsimore_phrasing_link">Tyxml</a>
</li><li><a href="/ocsigen-start/1.1.0/manual/intro" class="ocsimore_phrasing_link">Start</a>
</li></ul><div class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href="/" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href="/tuto/6.2/manual/intro" class="ocsimore_phrasing_link">Doc</a>
</li><li><a href="/eliom/6.3/manual/intro" class="ocsimore_phrasing_link">Eliom</a>
</li><li><a href="/js_of_ocaml/3.1.0/manual/overview" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-current"><a href="/ocsigenserver/2.9/manual/quickstart" class="ocsimore_phrasing_link">Server</a>
</li><li><a href="/lwt/3.2.1/manual/manual" class="ocsimore_phrasing_link">Lwt</a>
</li><li><a href="/tyxml/4.1.0/manual/intro" class="ocsimore_phrasing_link">Tyxml</a>
</li><li><a href="/ocsigen-toolkit/1.1.0/manual/intro" class="ocsimore_phrasing_link">Toolkit</a>
</li><li><a href="/ocsigen-start/1.1.0/manual/intro" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-page"><a href="/projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href="/papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href="/credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href="/blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><div class="how-doctree"><h1>Ocsigen server</h1><h2>Usage</h2><h3><a href="/ocsigenserver/2.8/manual/quickstart" class="ocsimore_phrasing_link">Quick start</a></h3><h3><a href="/ocsigenserver/2.8/manual/launching" class="ocsimore_phrasing_link">Launching the server</a></h3><h3><a href="/ocsigenserver/2.8/manual/config" class="ocsimore_phrasing_link">Configuration file</a></h3><h3><a href="/ocsigenserver/2.8/manual/misc" class="ocsimore_phrasing_link">Misc</a></h3><h2>Extensions</h2><h3><a href="/ocsigenserver/2.8/manual/staticmod" class="ocsimore_phrasing_link">Staticmod</a></h3><h3><a href="/ocsigenserver/2.8/manual/eliom" class="ocsimore_phrasing_link">Eliom</a></h3><h3><a href="/ocsigenserver/2.8/manual/extendconfiguration" class="ocsimore_phrasing_link">Extendconfiguration</a></h3><h3><a href="/ocsigenserver/2.8/manual/accesscontrol" class="ocsimore_phrasing_link">Accesscontrol</a></h3><h3><a href="/ocsigenserver/2.8/manual/authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h3><a href="/ocsigenserver/2.8/manual/cgimod" class="ocsimore_phrasing_link">CGImod</a></h3><h3><a href="/ocsigenserver/2.8/manual/deflatemod" class="ocsimore_phrasing_link">Deflatemod</a></h3><h3><a href="/ocsigenserver/2.8/manual/redirectmod" class="ocsimore_phrasing_link">Redirectmod</a></h3><h3><a href="/ocsigenserver/2.8/manual/revproxy" class="ocsimore_phrasing_link">Revproxy</a></h3><h3><a href="/ocsigenserver/2.8/manual/rewritemod" class="ocsimore_phrasing_link">Rewritemod</a></h3><h3><a href="/ocsigenserver/2.8/manual/outputfilter" class="ocsimore_phrasing_link">Outputfilter</a></h3><h3><a href="/ocsigenserver/2.8/manual/userconf" class="ocsimore_phrasing_link">Userconf</a></h3><h3><a href="/ocsigenserver/2.8/manual/comet" class="ocsimore_phrasing_link">Comet</a></h3><h3><a href="/ocsigenserver/2.8/manual/cors" class="ocsimore_phrasing_link">CORS</a></h3><h2>Developer documentation</h2><h3>Developing with the Ocsigen framework</h3><h4><a href="/ocsigenserver/2.8/manual/lwtoc" class="ocsimore_phrasing_link">Cooperative threads</a></h4><h4><a href="/ocsigenserver/2.8/manual/staticlink" class="ocsimore_phrasing_link">Static linking of the Ocsigen server</a></h4><h3><a href="/ocsigenserver/2.8/manual/extend" class="ocsimore_phrasing_link">Writing an extension</a></h3><h3><a href="/ocsigenserver/2.8/manual/libraries" class="ocsimore_phrasing_link">Libraries</a></h3><h3><a href="/ocsigenserver/2.8/manual/wrapping" class="ocsimore_phrasing_link">specific wrapping</a></h3></div></nav></div></div><button id="reason">Switch to </button><div class="twocols"><div class="leftcol"><div class="how-versions"><input id="how-versions-toggle" type="checkbox"/><label for="how-versions-toggle" class="how-versions-current">Version 2.8</label><div class="how-versions-all"><a href="/ocsigenserver/dev/manual/revproxy">dev</a><a href="/ocsigenserver/2.9/manual/revproxy">2.9</a><span class="how-versions-all-current">2.8</span><a href="/ocsigenserver/2.7/manual/revproxy">2.7</a><a href="/ocsigenserver/2.6/manual/revproxy">2.6</a><a href="/ocsigenserver/2.5/manual/revproxy">2.5</a><a href="/ocsigenserver/2.3/manual/revproxy">2.3</a><a href="/ocsigenserver/2.2/manual/revproxy">2.2</a><a href="/ocsigenserver/2.1/manual/revproxy">2.1</a><a href="/ocsigenserver/1.3.4/manual/revproxy">1.3.4</a><a href="/ocsigenserver/1.2.2/manual/revproxy">1.2.2</a><a href="/ocsigenserver/1.1.0/manual/revproxy">1.1.0</a></div></div><form id="search"><input name="q" id="q" placeholder="search ..."/><button>Search</button></form><div class="how-doctree"><h1>Ocsigen server</h1><h2>Usage</h2><h3><a href="/ocsigenserver/2.8/manual/quickstart" class="ocsimore_phrasing_link">Quick start</a></h3><h3><a href="/ocsigenserver/2.8/manual/launching" class="ocsimore_phrasing_link">Launching the server</a></h3><h3><a href="/ocsigenserver/2.8/manual/config" class="ocsimore_phrasing_link">Configuration file</a></h3><h3><a href="/ocsigenserver/2.8/manual/misc" class="ocsimore_phrasing_link">Misc</a></h3><h2>Extensions</h2><h3><a href="/ocsigenserver/2.8/manual/staticmod" class="ocsimore_phrasing_link">Staticmod</a></h3><h3><a href="/ocsigenserver/2.8/manual/eliom" class="ocsimore_phrasing_link">Eliom</a></h3><h3><a href="/ocsigenserver/2.8/manual/extendconfiguration" class="ocsimore_phrasing_link">Extendconfiguration</a></h3><h3><a href="/ocsigenserver/2.8/manual/accesscontrol" class="ocsimore_phrasing_link">Accesscontrol</a></h3><h3><a href="/ocsigenserver/2.8/manual/authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h3><a href="/ocsigenserver/2.8/manual/cgimod" class="ocsimore_phrasing_link">CGImod</a></h3><h3><a href="/ocsigenserver/2.8/manual/deflatemod" class="ocsimore_phrasing_link">Deflatemod</a></h3><h3><a href="/ocsigenserver/2.8/manual/redirectmod" class="ocsimore_phrasing_link">Redirectmod</a></h3><h3><a href="/ocsigenserver/2.8/manual/revproxy" class="ocsimore_phrasing_link">Revproxy</a></h3><h3><a href="/ocsigenserver/2.8/manual/rewritemod" class="ocsimore_phrasing_link">Rewritemod</a></h3><h3><a href="/ocsigenserver/2.8/manual/outputfilter" class="ocsimore_phrasing_link">Outputfilter</a></h3><h3><a href="/ocsigenserver/2.8/manual/userconf" class="ocsimore_phrasing_link">Userconf</a></h3><h3><a href="/ocsigenserver/2.8/manual/comet" class="ocsimore_phrasing_link">Comet</a></h3><h3><a href="/ocsigenserver/2.8/manual/cors" class="ocsimore_phrasing_link">CORS</a></h3><h2>Developer documentation</h2><h3>Developing with the Ocsigen framework</h3><h4><a href="/ocsigenserver/2.8/manual/lwtoc" class="ocsimore_phrasing_link">Cooperative threads</a></h4><h4><a href="/ocsigenserver/2.8/manual/staticlink" class="ocsimore_phrasing_link">Static linking of the Ocsigen server</a></h4><h3><a href="/ocsigenserver/2.8/manual/extend" class="ocsimore_phrasing_link">Writing an extension</a></h3><h3><a href="/ocsigenserver/2.8/manual/libraries" class="ocsimore_phrasing_link">Libraries</a></h3><h3><a href="/ocsigenserver/2.8/manual/wrapping" class="ocsimore_phrasing_link">specific wrapping</a></h3></div></div><div class="rightcol"><h1>Revproxy</h1><p>Revproxy is a reverse proxy for Ocsigen.
</p><p>This module allows to transmit some requests to another Web server using the HTTP or HTTPS protocol. For example if you want to use Ocsigen together with another Web server (Apache, Tomcat, etc. or even another Ocsigen).
</p><h3>Configuration</h3><p>To use the reverse proxy, first load the extension from the configuration file:
</p><pre>&lt;extension findlib-package=&quot;ocsigenserver.ext.revproxy&quot;/&gt;
</pre><p>Then configure your hosts as in these examples:
</p><pre>&lt;revproxy suburl=&quot;(.*)&quot; dest=&quot;http://my.newaddress.org:8080/\1&quot;/&gt;
&lt;revproxy suburl=&quot;dir/(.*)\.html&quot; dest=&quot;https://my.newaddress.org/\1.php&quot;/&gt;
&lt;revproxy fullurl=&quot;http://(.*).mydomain.org:(80|8080)/(.*)&quot; dest=&quot;http://\1.my.newdomain.org:\2/\3&quot;/&gt;
</pre><p>regexp is a regular expression using PERL syntax (PCRE). The destination URL is built from dest, where \i corresponds to the i-th part between parenthesis of the regular expression (was $i in older versions).
</p><p>Add the attribute <span class="teletype">keephost=&quot;keephost&quot;</span> if you want to send the original <span class="teletype">Host</span> header to the distant server.
Otherwise, it will be computed from <span class="teletype">dest</span>.
</p><p>Add the attribute <span class="teletype">nopipeline=&quot;nopipeline&quot;</span> if for some reason you don't want to pipeline reverse proxy's requests. With that option, the reverse proxy will open a new connection for all requests, instead of trying to reuse connections. You probably don't need that, but if you do, please contact us to tell us what is the problem. Thank you!
</p><p>You probably also need to rewrite locations in the output (if the server is doing redirections). For example:
</p><pre>&lt;outputfilter header=&quot;location&quot; regexp=&quot;http://my.newaddress.org/(.*)&quot; dest=&quot;http://my.publicaddress.org/\1&quot;/&gt;
</pre><p>Note that if you are using ocsigen behind a reverse proxy handling X-Forward-For and X-Forward-Proto headers ( like the revproxy module ), you should allow ocsigen to use those informations, using accesscontrol extension
</p><pre>&lt;if&gt;
	&lt;ip value=&quot;ip of the proxy&quot;/&gt;
	&lt;then&gt;
	 	&lt;allow-forward-for/&gt;
    		&lt;allow-forward-proto/&gt;
	&lt;/then&gt;
&lt;/if&gt;
</pre><h3>Technical details</h3><ul><li> The reverse proxy does no caching for now.
</li><li> The reverse proxy does pipeline the requests for server it trusts for pipelining. But current trusting criteria are probably too strong. They will probably evolve soon.
</li></ul><p>The old syntax was (before 1.2):
</p><pre>&lt;revproxy regexp=&quot;(.*)&quot; server=&quot;my.newaddress.org&quot; port=&quot;8080&quot; uri=&quot;$1&quot;/&gt;
&lt;revproxy regexp=&quot;dir/(.*)\.html&quot; protocol=&quot;https&quot; server=&quot;my.newaddress.org&quot; uri=&quot;$1.php&quot;/&gt;
</pre></div></div></div></body></html>
