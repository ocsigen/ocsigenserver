<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Module Ocsigen_extensions </title><meta charset="utf8"/><link rel="stylesheet" href="/home/balat/ocsigen/ocsigen.github.io/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js"></script><script src="/home/balat/ocsigen/html_of_wiki/client.js"></script></head><body><h1>Module <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions">Ocsigen_extensions</a></span> </h1><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span class="ocsforge_color_uid"><span class="ocsforge_color_uid">Ocsigen_extensions</span></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions">..</a></span><span class="ocsforge_color_keyword">end</span></pre><p>Writing extensions for Ocsigen
</p><hr/><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">include</span> Ocsigen_command</pre><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions.Ocsigen_request_info">Ocsigen_request_info</a></span> <span class="ocsforge_color_delimiter">:</span> <br/>  <span class="odocwiki_type">module type of Ocsigen_request_info</span><span class="odocwiki_type"><br/>                                with type request_info = Ocsigen_request_info.request_info<br/>                                 and type file_info = Ocsigen_request_info.file_info<br/>                                 and type ifrange = Ocsigen_request_info.ifrange</span></pre><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONOcsigen_http_error"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Ocsigen_http_error</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></pre><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONBad_config_tag_for_extension"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Bad_config_tag_for_extension</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">string</span></pre><div class="odocwiki_info"><p>Xml tag not recognized by an extension (usually not a real error)</p></div><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONError_in_config_file"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Error_in_config_file</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">string</span></pre><div class="odocwiki_info"><p>Error in a &lt;site&gt; tag inside the main ocsigen.conf file</p></div><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONError_in_user_config_file"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Error_in_user_config_file</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">string</span></pre><div class="odocwiki_info"><p>Option incorrect in a userconf file</p></div><pre class="ocsforge_color odocwiki_code" id="VALbadconfig"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">badconfig</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'a, unit, string, 'b<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Pervasives</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">format4</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a</span></pre><div class="odocwiki_info"><p>Convenient function for raising Error_in_config_file exceptions with
a sprintf-formatted argument.</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEvirtual_hosts"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">virtual_hosts</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>string * <span class="ocsforge_color_uid">Netstring_pcre</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">regexp</span> * int option<span class="ocsforge_color_delimiter">)</span> list</span></pre><div class="odocwiki_info"><p>Type of the result of parsing the field <span class="odocwiki_inlinecode">hostfiler</span> in the configuration
file. Inside the list, the first argument is the host itself
(which is a glob-like pattern that can contains <span class="odocwiki_inlinecode">*</span>), a regexp
parsing this pattern, and optionnaly a port.</p></div><pre class="ocsforge_color odocwiki_code" id="VALhash_virtual_hosts"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">hash_virtual_hosts</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><pre class="ocsforge_color odocwiki_code" id="VALequal_virtual_hosts"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">equal_virtual_hosts</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> bool</span></pre><pre class="ocsforge_color odocwiki_code" id="VALhost_match"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">host_match</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">virtual_hosts:</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">host:</span>string option <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_label">port:</span>int <span class="ocsforge_color_delimiter">-&gt;</span> bool</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEdo_not_serve"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">do_not_serve</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_regexps:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_files:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_extensions:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><div class="odocwiki_info"><p>Configuration to hide/forbid local files</p></div><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONIncorrectRegexpes"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">IncorrectRegexpes</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALdo_not_serve_to_regexp"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">do_not_serve_to_regexp</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_uid">Netstring_pcre</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">regexp</span></span></pre><div class="odocwiki_info"><p>Compile a do_not_serve structure into a regexp. Raises
<span class="odocwiki_inlinecode">IncorrectRegexpes</span> if the compilation fails. The result is
memoized for subsequent calls with the same argument</p></div><pre class="ocsforge_color odocwiki_code" id="VALjoin_do_not_serve"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">join_do_not_serve</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEconfig_info"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">config_info</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_hostname:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_httpport:</span> <span class="odocwiki_type">int</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_httpsport:</span> <span class="odocwiki_type">int</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_protocol_is_https:</span> <span class="odocwiki_type">bool</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">mime_assoc:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_charset_mime#TYPEmime_assoc">Ocsigen_charset_mime.mime_assoc</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">charset_assoc:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_charset_mime#TYPEcharset_assoc">Ocsigen_charset_mime.charset_assoc</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">default_directory_index:</span> <span class="odocwiki_type">string list</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">list_directory_content:</span> <span class="odocwiki_type">bool</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">follow_symlinks:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEfollow_symlink">follow_symlink</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_404:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">do_not_serve_403:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">uploaddir:</span> <span class="odocwiki_type">string option</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">maxuploadfilesize:</span> <span class="odocwiki_type">int64 option</span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><div class="odocwiki_info"><p>Configuration options, passed to (and modified by) extensions</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEfollow_symlink"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">follow_symlink</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_variants"><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">DoNotFollowSymlinks</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Never follow a symlink
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">FollowSymlinksIfOwnerMatch</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Follow a symlink if the symlink and its
                                   target have the same owner
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">AlwaysFollowSymlinks</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Always follow symlinks
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEclient"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">client</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_http_com#TYPEconnection">Ocsigen_http_com.connection</a></span></span></pre><div class="odocwiki_info"><p>A value of this type represents the client who did the request.</p></div><pre class="ocsforge_color odocwiki_code" id="VALclient_id"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">client_id</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEclient">client</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><div class="odocwiki_info"><p>Returns the id number of the connection</p></div><pre class="ocsforge_color odocwiki_code" id="VALclient_connection"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">client_connection</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEclient">client</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_http_com#TYPEconnection">Ocsigen_http_com.connection</a></span></span></pre><div class="odocwiki_info"><p>Returns the connection</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEifrange"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">ifrange</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Ocsigen_request_info</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">ifrange</span></span>  <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_variants"><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">IR_No</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">IR_Ifunmodsince</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">float</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">IR_ifmatch</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">string</span></span></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEfile_info"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">file_info</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Ocsigen_request_info</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">file_info</span></span>  <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">tmp_filename:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">filesize:</span> <span class="odocwiki_type">int64</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">raw_original_filename:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">original_basename:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">file_content_type:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_delimiter">(</span>string * string<span class="ocsforge_color_delimiter">)</span> * <span class="ocsforge_color_delimiter">(</span>string * string<span class="ocsforge_color_delimiter">)</span> list<span class="ocsforge_color_delimiter">)</span> option</span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPErequest_info"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">request_info</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Ocsigen_request_info</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">request_info</span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPErequest"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">request</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">request_info:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest_info">request_info</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">request_config:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEconfig_info">config_info</a></span></span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONOcsigen_Is_a_directory"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Ocsigen_Is_a_directory</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_uid">Ocsigen_request_info</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">request_info</span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_uid">Neturl</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">url</span><span class="ocsforge_color_delimiter">)</span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEanswer"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">answer</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_variants"><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_do_nothing</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~I don~'t want to do anything
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_found</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_uid">Ocsigen_http_frame</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">result</span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|&quot;~O~K stop! ~I will take the page~.
      ~You can start the following request of the same pipelined connection~.
      ~Here is the function to generate the page&quot;~.
      ~The extension must return ~Ext~_found as soon as possible
      when it is sure it is safe to start next request~.
      ~Usually as soon as you know that the result will be ~Ext~_found~.
      ~But in some case~, for example proxies~, you don~'t want the request of
      one connection to be handled in different order~.
      ~In that case~, wait to be sure that the new request will not
      overtake this one~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_found_stop</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_uid">Ocsigen_http_frame</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">result</span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Found but do not try next extensions
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_next</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type">int</span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Page not found~. ~Try next extension~.
                        ~The integer is the ~H~T~T~P error code~.
                        ~It is usally ~4~0~4~, but may be for ex ~4~0~3 ~(forbidden~)
                        if you want another extension to try after a ~4~0~3~.
                        ~Same as ~Ext~_continue~_with but does not change
                        the request~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_stop_site</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Error~. ~Do not try next extension~, but
      try next site~.
      ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_stop_host</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Error~. ~Do not try next extension~,
      do not try next site~,
      but try next host~.
      ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_stop_all</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Error~. ~Do not try next extension ~(even filters~)~,
      do not try next site~,
      do not try next host~,
      do not ~.
      ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_continue_with</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span> * <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> * int<span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Used to modify the request before giving it to next extension~.
      ~The extension returns the request~_info ~(possibly modified~)
      and a set of cookies if it wants to set or cookies
      ~(&lt;&lt;span class=&quot;odocwiki_inlinecode&quot;|!~Ocsigen~_cookies~.~Cookies~.empty&gt;&gt; for no cookies~)~.
      ~You must add these cookies yourself in request~_info if you
      want them to be seen by subsequent extensions~,
      for example using &lt;&lt;a_api | val Ocsigen_http_frame.compute_new_ri_cookies &gt;&gt;~.
      ~The integer is usually equal to the error code received
      from preceding extension ~(but you may want to modify it~)~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_retry_with</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span> * <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Used to retry all the extensions with a new request~_info~.
      ~The extension returns the request~_info ~(possibly modified~)
      and a set of cookies if it wants to set or cookies
      ~(&lt;&lt;span class=&quot;odocwiki_inlinecode&quot;|!~Ocsigen~_cookies~.~Cookies~.empty&gt;&gt; for no cookies~)~.
      ~You must add these cookies yourself in request~_info if you
      want them to be seen by subsequent extensions~,
      for example using &lt;&lt;a_api | val Ocsigen_http_frame.compute_new_ri_cookies &gt;&gt;~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_sub_result</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEextension2">extension2</a></span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Used if your extension want to define option that may contain
      other options from other extensions~.
      ~In that case~, while parsing the configuration file~, call
      the parsing function ~(of type &lt;&lt;span class=&quot;odocwiki_inlinecode&quot;|parse~_fun&gt;&gt;~)~,
      that will return something of type &lt;&lt;span class=&quot;odocwiki_inlinecode&quot;|extension~2&gt;&gt;~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_found_continue_with</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><br/>    <span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span><br/>     <span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_uid">Ocsigen_http_frame</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">result</span> * <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Same as &lt;&lt;span class=&quot;odocwiki_inlinecode&quot;|~Ext~_found&gt;&gt; but may modify the request~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Ext_found_continue_with'</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_uid">Ocsigen_http_frame</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">result</span> * <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span><span class="ocsforge_color_delimiter">)</span></span></span><span class="odocwiki_comments"><span class="odocwiki_comments_open">(*</span> <span>&lt;&lt;div class=&quot;odocwiki_info&quot;|~Same as &lt;&lt;span class=&quot;odocwiki_inlinecode&quot;|~Ext~_found~_continue~_with&gt;&gt; but does not allow to delay
      the computation of the page~. ~You should probably not use it~,
      but for output filters~.
&gt;&gt;</span><span class="odocwiki_comments_close"> *)</span></span></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPErequest_state"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">request_state</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_variants"><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Req_not_found</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>int * <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span><span class="ocsforge_color_delimiter">)</span></span></span></span><span class="odocwiki_variant"><span class="odocwiki_variant_constr"><span class="ocsforge_color_keyword"> |</span> <span class="ocsforge_color_uid">Req_found</span> <span class="ocsforge_color_keyword">of</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span> * <span class="ocsforge_color_uid">Ocsigen_http_frame</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">result</span><span class="ocsforge_color_delimiter">)</span></span></span></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEextension2"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">extension2</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  request_state <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_delimiter">(</span>answer * <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEextension"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">extension</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest_state">request_state</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEanswer">answer</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>For each &lt;site&gt; tag in the configuration file,
you can set the extensions you want.
Each extension is implemented as a function, taking
the charset found in configuration file,
the current state of the request,
and returning an answer.
If no page has been generated so far (<span class="odocwiki_inlinecode">Req_not_found</span>), it receive
the error code given by the previous extension (default 404),
and the request information.
If a page has been generated by previous extensions (case <span class="odocwiki_inlinecode">Req_found</span>),
the extension may want to modify the result (filters).</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEparse_fun"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_fun</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Simplexmlparser</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">xml</span> list <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEextension2">extension2</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEparse_host"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_host</span></pre><div class="odocwiki_info"><p>Type of the functions parsing the content of a &lt;host&gt; tag</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEuserconf_info"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">userconf_info</span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_delimiter">{</span>
<span class="odocwiki_record"><span class="odocwiki_field"><span class="odocwiki_field_descr">  <span class="ocsforge_color_label">localfiles_root:</span> <span class="odocwiki_type">string</span><span class="ocsforge_color_delimiter">;</span></span></span></span><span class="ocsforge_color_delimiter">}</span></pre><div class="odocwiki_info"><p>Information received by extensions accepting userconf files.
</p><p>The parameter <span class="odocwiki_inlinecode">localfiles_root</span> is an absolute path to the
directory that the user is allowed to serve. This is used
by staticmod, to disallow the user from allowing access to
outside of this directory</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEparse_config"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_config</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEconfig_info">config_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> parse_config_aux</span></pre><div class="odocwiki_info"><p><span class="odocwiki_inlinecode">parse_config</span> is the type of the functions parsing a &lt;site&gt; tag
(and returning an extension).  Those are functions taking

</p><ul><li> the name of the virtual &lt;host&gt;
</li></ul><p>that will be called for each &lt;host&gt;,
and that will generate a function taking:

</p><ul><li> the path attribute of a &lt;site&gt; tag
</li></ul><p>that will be called for each &lt;site&gt;,
and that will generate a function taking:

</p><ul><li> an item of the config file
</li></ul><p>that will be called on each tag inside &lt;site&gt; and:

</p><ul><li> raise <span class="odocwiki_inlinecode">Bad_config_tag_for_extension</span> if it does not recognize that tag
</li><li> return something of type <span class="odocwiki_inlinecode">extension</span> (filter or page generator)
</li></ul><p><span class="odocwiki_inlinecode">parse_config_user</span> is the type of functions parsing a site tag
inside an userconf file. They take one more parameter, of type userconf_info</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEparse_config_user"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_config_user</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEuserconf_info">userconf_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> parse_config</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEparse_config_aux"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">parse_config_aux</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_uid">Ocsigen_lib</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_uid">Url</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">path</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEparse_host">parse_host</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEparse_fun">parse_fun</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_uid">Simplexmlparser</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">xml</span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEextension">extension</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALregister_extension"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">register_extension</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">name:</span>string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?fun_site:</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEparse_config">parse_config</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?user_fun_site:</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEparse_config_user">parse_config_user</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?begin_init:</span><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?end_init:</span><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?init_fun:</span><span class="ocsforge_color_delimiter">(</span><span class="ocsforge_color_uid">Simplexmlparser</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">xml</span> list <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?exn_handler:</span><span class="ocsforge_color_delimiter">(</span>exn <span class="ocsforge_color_delimiter">-&gt;</span> string<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_label">?respect_pipeline:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>For each extension generating pages, we register its name and six functions:
</p><ul><li> a function <span class="odocwiki_inlinecode">fun_site</span> of type <span class="odocwiki_inlinecode">parse_config</span>. This function
will be responsible for handling the options of the configuration
files that are recognized by the extension, and potentially generating
a page.
</li><li> a function <span class="odocwiki_inlinecode">user_fun_site</span> of type <span class="odocwiki_inlinecode">parse_user_config</span> which has the
same role as <span class="odocwiki_inlinecode">fun_site</span>, but inside userconf files. Specify nothing
if your extension is disallowed in userconf files. Otherwise, compared
to <span class="odocwiki_inlinecode">fun_site</span>, you can selectively disallow some options,
as <span class="odocwiki_inlinecode">user_fun_site</span> must define only safe options (for example it is not
safe to allow such options to load a cmo specified by a user, or to
execute a program, as this program will be executed by ocsigen's user).
Note that <span class="odocwiki_inlinecode">user_fun_site</span> will be called for every request, whereas the
<span class="odocwiki_inlinecode">fun_site</span> is called only when starting or reloading the server.
</li><li> a function <span class="odocwiki_inlinecode">begin_init</span> that will be called at the beginning
of the initialisation phase of each site, and each time the config file is
reloaded.
</li><li> a function <span class="odocwiki_inlinecode">end_init</span> that will be called at the end of the initialisation
phase of each site
</li><li> a function <span class="odocwiki_inlinecode">init_fun</span> that will be called just before registering the
extension, taking as parameter the configuration options between
<span class="odocwiki_inlinecode">&lt;extension&gt;</span> and <span class="odocwiki_inlinecode">&lt;/extension&gt;</span>. This allows to give configuration options
to extensions. If no function is supplied, the extension is supposed to
accept no option (and loading will fail if an option is supplied)
See &lt;&lt;a_api module=&quot;Ocsigen_extensions.Configuration&quot; | val process_elements &gt;&gt; for
the easy construction of such a function.
</li><li> a function <span class="odocwiki_inlinecode">exn_handler</span> that will create an error message from the
exceptions that may be raised during the initialisation phase, and raise again
all other exceptions
</li></ul><p>Moreover, if the optional parameter <span class="odocwiki_inlinecode">?respect_pipeline</span> is <span class="odocwiki_inlinecode">true</span>,
the extension will ask the server to respect the order of the
pipeline. That means that it will wait to be sure that the previous
request from the same connection has been taken by an extension
before giving a request to an extension.  Use this to write proxies
extensions, when you want to be able to pipeline the requests you
to another server. It is false by default.</p></div><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions.Configuration">Configuration</a></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions.Configuration">..</a></span><span class="ocsforge_color_keyword">end</span></pre><div class="odocwiki_info"><p>This modules contains types and constructor for the description of XML
configurations and the accordingly parsing.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_hostname"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_hostname</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> string</span></pre><div class="odocwiki_info"><p>Returns the hostname to be used for absolute links or redirections.
It is either the Host header or the hostname set in
the configuration file.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_port"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_port</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><div class="odocwiki_info"><p>Returns the port to be used for absolute links or redirections.
It is either:
</p><ul><li> the port the server is listening at
</li><li> or the port in the Host header
</li><li> or the default port set in the configuration file.</li></ul></div><pre class="ocsforge_color odocwiki_code" id="VALnew_url_of_directory_request"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">new_url_of_directory_request</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest">request</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest_info">request_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_uid">Neturl</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">url</span></span></pre><div class="odocwiki_info"><p>new_url_of_directory_request create a redirection and generating a new url
for the client (depending on the server configuration and request)</p></div><pre class="ocsforge_color odocwiki_code" id="VALri_of_url"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">ri_of_url</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">?full_rewrite:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest_info">request_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest_info">request_info</a></span></span></pre><div class="odocwiki_info"><p>Parsing URLs.
This allows to modify the URL in the request_info.
(to be used for example with Ext_retry_with or Ext_continue_with)</p></div><h3 id="3_Userdirectories">User directories <a class="backref" href="#3_Userdirectories">&#182;</a></h3><p>Exception raised when an non-existing user is found
</p><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONNoSuchUser"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">NoSuchUser</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEud_string"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">ud_string</span></pre><div class="odocwiki_info"><p>The type for string that may contain a $u(...)</p></div><pre class="ocsforge_color odocwiki_code" id="VALparse_user_dir"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">parse_user_dir</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">string <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEud_string">ud_string</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALreplace_user_dir"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">replace_user_dir</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_uid">Netstring_pcre</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">regexp</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEud_string">ud_string</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> string <span class="ocsforge_color_delimiter">-&gt;</span> string</span></pre><div class="odocwiki_info"><p>raises <span class="odocwiki_inlinecode">Not_found</span> is the directory does not exist</p></div><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONNot_concerned"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Not_concerned</span></pre><div class="odocwiki_info"><h3 id="3_Regularexpressionsforredirections">Regular expressions for redirections <a class="backref" href="#3_Regularexpressionsforredirections">&#182;</a></h3></div><pre class="ocsforge_color odocwiki_code" id="VALfind_redirection"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">find_redirection</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_uid">Netstring_pcre</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">regexp</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  string option <span class="ocsforge_color_delimiter">-&gt;</span> int <span class="ocsforge_color_delimiter">-&gt;</span> string option <span class="ocsforge_color_delimiter">-&gt;</span> string <span class="ocsforge_color_delimiter">-&gt;</span> string <span class="ocsforge_color_delimiter">-&gt;</span> string</span></pre><pre class="ocsforge_color odocwiki_code" id="VALmake_parse_config"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">make_parse_config</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_uid">Ocsigen_lib</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_uid">Url</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">path</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEparse_config_aux">parse_config_aux</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEparse_fun">parse_fun</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALparse_config_item"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">parse_config_item</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEparse_config">parse_config</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALparse_user_site_item"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">parse_user_site_item</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEparse_config_user">parse_config_user</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALset_hosts"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">set_hosts</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> * <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEconfig_info">config_info</a></span> *<br/>   <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEextension2">extension2</a></span><span class="ocsforge_color_delimiter">)</span><br/>  list <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><pre class="ocsforge_color odocwiki_code" id="VALget_hosts"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_hosts</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  unit <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> * <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEconfig_info">config_info</a></span> *<br/>   <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEextension2">extension2</a></span><span class="ocsforge_color_delimiter">)</span><br/>  list</span></pre><pre class="ocsforge_color odocwiki_code" id="VALcompute_result"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">compute_result</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">?previous_cookies:</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cookies#TYPEcookieset">Ocsigen_cookies.cookieset</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?awake_next_request:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest_info">request_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_uid">Ocsigen_http_frame</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">result</span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Compute the result to be sent to the client,
by trying all extensions according the configuration file.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_number_of_connected"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_number_of_connected</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><div class="odocwiki_info"><p>Profiling</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_number_of_connected"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_number_of_connected</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><pre class="ocsforge_color odocwiki_code" id="VALincr_connected"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">incr_connected</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">int <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Server internal functions:</p></div><pre class="ocsforge_color odocwiki_code" id="VALdecr_connected"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">decr_connected</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALwait_fewer_connected"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">wait_fewer_connected</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">int <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALduring_initialisation"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">during_initialisation</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> bool</span></pre><pre class="ocsforge_color odocwiki_code" id="VALstart_initialisation"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">start_initialisation</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><pre class="ocsforge_color odocwiki_code" id="VALend_initialisation"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">end_initialisation</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><pre class="ocsforge_color odocwiki_code" id="VALget_numberofreloads"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_numberofreloads</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><pre class="ocsforge_color odocwiki_code" id="VALget_init_exn_handler"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_init_exn_handler</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> exn <span class="ocsforge_color_delimiter">-&gt;</span> string</span></pre><pre class="ocsforge_color odocwiki_code" id="VALset_config"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">set_config</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Simplexmlparser</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">xml</span> list <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><pre class="ocsforge_color odocwiki_code" id="VALclient_of_connection"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">client_of_connection</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_http_com#TYPEconnection">Ocsigen_http_com.connection</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPEclient">client</a></span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALget_server_address"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_server_address</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_extensions#TYPErequest_info">request_info</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_uid">Unix</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">inet_addr</span> * int</span></pre><pre class="ocsforge_color odocwiki_code" id="VALsockets"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">sockets</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Lwt_unix</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">file_descr</span> list <span class="ocsforge_color_uid">Pervasives</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">ref</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALsslsockets"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">sslsockets</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Lwt_unix</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">file_descr</span> list <span class="ocsforge_color_uid">Pervasives</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">ref</span></span></pre></body></html>
